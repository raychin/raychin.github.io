(window.webpackJsonp=window.webpackJsonp||[]).push([[5,10,11,12],{167:function(e,t,a){"use strict";a.r(t);var r=a(179);for(var n in r)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(n);var i=a(19),o=Object(i.a)(r.default,void 0,void 0,!1,null,null,null);o.options.__file="src/pages/map/components/buildLayer.vue",t.default=o.exports},168:function(e,t,a){"use strict";a.r(t);var r=a(183);for(var n in r)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(n);var i=a(19),o=Object(i.a)(r.default,void 0,void 0,!1,null,null,null);o.options.__file="src/pages/map/components/districtLayer.vue",t.default=o.exports},169:function(e,t,a){"use strict";a.r(t);var r=a(231),n=a(185);for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);a(225);var o=a(19),u=Object(o.a)(n.default,r.a,r.b,!1,null,"9474feb2",null);u.options.__file="src/pages/map/components/mapLayer.vue",t.default=u.exports},170:function(e,t,a){"use strict";a.r(t);var r=a(188);for(var n in r)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(n);var i=a(19),o=Object(i.a)(r.default,void 0,void 0,!1,null,null,null);o.options.__file="src/pages/map/components/operateLayer.vue",t.default=o.exports},173:function(e,t,a){"use strict";a.r(t);var r=a(302),n=a(227);for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);a(298);var o=a(19),u=Object(o.a)(n.default,r.a,r.b,!1,null,"238590d5",null);u.options.__file="src/pages/map/map.vue",t.default=u.exports},179:function(e,t,a){"use strict";a.r(t);var r=a(180),n=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);t.default=n.a},180:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n,i=h(a(73)),o=h(a(181)),u=h(a(182)),s=h(a(174)),l=h(a(191)),c=h(a(192)),d=a(193),f=a(194),p=a(175);function h(e){return e&&e.__esModule?e:{default:e}}t.default={name:"buildLayer",mixins:[d.getMap,f.dataMixins],props:{showMinZoom:{type:Number,default:17},defaultLineSymbol:{type:Object,default:function(){return{"line-color":"#1E90FF","line-width":3}}},defaultSymbol:{type:Object,default:function(){return{"fill-outline-color":"#34495e","fill-color":["case",["has","hasCollect"],["to-color","rgb(176,196,222)"],["to-color","rgb(135,206,250)"]],"fill-opacity":.6}}}},mounted:function(){this.layer=this.initLayer(),this.addViewChange()},methods:{initLayer:function(){var e="buildLayer";return this.map.getLayer(e)||(this.map.addSource(e+"Source",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:e+"-line",type:"line",source:e+"Source",layout:{},paint:(0,s.default)({},this.defaultLineSymbol)}),this.map.addLayer({id:e,type:"fill",source:e+"Source",layout:{},paint:(0,s.default)({},this.defaultSymbol)})),this.map.getLayer(e)},addViewChange:function(){var e=this;this.map.on("moveend",(0,u.default)(o.default.mark((function t(){var a,r;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.map.getZoom()>=e.$props.showMinZoom)){t.next=8;break}return t.next=4,e.getBuildData();case 4:(a=t.sent)&&a.length&&(r=e.geojsonToGeo(a),e.renderGeo(r,!1)),t.next=9;break;case 8:e.clear();case 9:case"end":return t.stop()}}),t,e)}))))},addLayerClick:function(){var e=this;this.map.on("click","buildLayer",(function(t){e.$emit("click",t)}))},getBuildData:(n=(0,u.default)(o.default.mark((function e(){var t,a,r,n,u,s,d,f,h;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.map.getBounds(),a=[[t.getWest(),t.getNorth()],[t.getEast(),t.getSouth()]],r=c.default.getViewAreaByBuilding,n=r.url,u=r.request_type,e.prev=3,e.next=6,l.default.Ajax(""+p.blockUrl+n,{request_type:u,paramCodeList:"KJ5003",coordinates:(0,i.default)(a)});case 6:if(s=e.sent,d=s.data,f=d.retCode,h=d.data,"00000"!==f){e.next=12;break}return e.abrupt("return",h.list);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),this.clear();case 17:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(){return n.apply(this,arguments)}),houseStatus:(r=(0,u.default)(o.default.mark((function e(t){var a,r,n,i,u,s,l;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=[],r=t,n="",i=0;i<r.length;i++)n+=(0===i?"":",")+r[i].areacode;return u={houseid:n},e.next=7,this.request.postNoLoading("collect:houseStatus",u);case 7:if(!(s=e.sent)||200!=s.code){e.next=11;break}for(l=0;l<r.length;l++)(s.data[r[l].areacode]||"0"===s.data[r[l].areacode])&&(r[l].hasCollect="1"),a.push(r[l]);return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)}),clear:function(){this.map.getSource(this.layer.id+"Source").setData({type:"FeatureCollection",features:[]})}}}},183:function(e,t,a){"use strict";a.r(t);var r=a(184),n=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);t.default=n.a},184:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n,i=h(a(73)),o=h(a(181)),u=h(a(182)),s=h(a(174)),l=h(a(191)),c=h(a(192)),d=a(193),f=a(194),p=a(175);function h(e){return e&&e.__esModule?e:{default:e}}t.default={name:"districtLayer",mixins:[d.getMap,f.dataMixins],props:{regionZoom:{type:Number,default:9},streetZoom:{type:Number,default:13},coummunityZoom:{type:Number,default:15},gridZoom:{type:Number,default:17},showMinZoom:{type:Number,default:9},defaultLineSymbol:{type:Object,default:function(){return{"line-color":"#FF8C00","line-width":3}}},defaultSymbol:{type:Object,default:function(){return{"fill-color":"#FFDEAD","fill-opacity":0}}}},mounted:function(){this.layer=this.initLayer(),this.clear(),this.initDistrict(),this.addViewChange()},methods:{initLayer:function(){var e="districtLayer";return this.map.getLayer(e)||(this.map.addSource(e+"Source",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:e+"-line",type:"line",source:e+"Source",layout:{},paint:(0,s.default)({},this.defaultLineSymbol)}),this.map.addLayer({id:e,type:"fill",source:e+"Source",layout:{},paint:(0,s.default)({},this.defaultSymbol)})),this.map.getLayer(e)},initDistrict:(n=(0,u.default)(o.default.mark((function e(){var t,a;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.map.getZoom()>=this.$props.showMinZoom)){e.next=6;break}return e.next=4,this.getDistrict();case 4:(t=e.sent)&&t.length&&(a=this.geojsonToGeo(t),this.renderGeo(a,!1));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),addViewChange:function(){var e=this;this.map.on("moveend",(0,u.default)(o.default.mark((function t(){var a,r;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.map.getZoom()>=e.$props.showMinZoom)){t.next=8;break}return t.next=4,e.getDistrict();case 4:(a=t.sent)&&a.length&&(r=e.geojsonToGeo(a),e.renderGeo(r,!1)),t.next=9;break;case 8:e.clear();case 9:case"end":return t.stop()}}),t,e)}))))},addLayerClick:function(){var e=this;this.map.on("click","districtLayer",(function(t){e.$emit("click",t)}))},getDistrict:(r=(0,u.default)(o.default.mark((function e(){var t,a,r,n,u,s,d,f,h,m,y;return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.map.getBounds(),a=[[t.getWest(),t.getNorth()],[t.getEast(),t.getSouth()]],r=1,(n=this.map.getZoom())>=this.$props.gridZoom?r=4:n>=this.$props.coummunityZoom?r=3:n<=this.$props.streetZoom?r=2:n>=this.$props.regionZoom&&(r=1),u=c.default.getViewAreaByBuilding,s=u.url,d=u.request_type,e.prev=6,e.next=9,l.default.Ajax(""+p.blockUrl+s,{request_type:d,paramCodeList:"KJ5003",paramType:r,coordinates:(0,i.default)(a)});case 9:if(f=e.sent,h=f.data,m=h.retCode,y=h.data,"00000"!==m){e.next=15;break}return e.abrupt("return",y);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),this.clear();case 20:case"end":return e.stop()}}),e,this,[[6,17]])}))),function(){return r.apply(this,arguments)}),clear:function(){this.map.getSource(this.layer.id+"Source").setData({type:"FeatureCollection",features:[]})}}}},185:function(e,t,a){"use strict";a.r(t);var r=a(186),n=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);t.default=n.a},186:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=a(174),i=(r=n)&&r.__esModule?r:{default:r},o=a(77),u=a(175);var s=null;t.default={name:"mapLayer",props:{mapOptions:Object},provide:function(){return{mapProvider:this.mapProvider}},data:function(){return this.mapProvider={},{domId:"map-"+(new Date).getTime(),mapFlag:!1}},mounted:function(){var e=this,t=this.initMap();this.mapProvider.map=t,t.on("load",(function(){e.mapFlag=!0})),this.addLayerClick()},methods:{initMap:function(){var e=this.$props.mapOptions,t=this.$data.domId;return new GeoGlobe.Map((0,i.default)({container:t,style:{version:8,sources:{bd:{tiles:[u.mapBgUrl+"/tile/{z}/{y}/{x}"],type:"raster",zoomOffset:10,tileSize:256}},layers:[{id:"base_layer",type:"raster",source:"bd","raster-opacity":1}]},mapCRS:{topTileExtent:[-180,-270,180,90],coordtransform:"none"},zoom:11,minZoom:10,maxZoom:22,center:[113.9255976,22.536474762],pitch:0,bearing:0,epsg:"EPSG:4490",doubleClickZoom:!1,isIntScrollZoom:!0,renderWorldCopies:!1,isAttributionControl:!1,is3Dpitching:!1},e))},getMap:function(){return this.mapProvider.map},addLayerClick:function(){var e=this;this.mapProvider.map.on("click",(function(t){var a=e.mapProvider.map.queryRenderedFeatures(t.point,{sourceLayer:"buildLayer"});if(console.log(a),0===a.length)o.Toast.fail("超出操作范围");else{for(var r=!1,n=0;n<a.length;n++)if("buildLayer"===a[n].layer.id){console.log(a[n]),e.showPopup(a[n].properties.lon,a[n].properties.lat,a[n].properties.areaname),r=!0,e.$emit("click",a[n]);break}r||o.Toast.fail("请选择房屋")}}))},showPopup:function(e,t,a){null!==s&&s.remove();var r=[e,t];(s=new GeoGlobe.Popup({closeOnClick:!1}).setLngLat(r).setHTML('<div><div style="margin-right:.2rem;background: #ffffff;">'+a+"</div></div>").addTo(this.mapProvider.map)).on("close",(function(e){console.log(e)}))}}}},187:function(e,t,a){var r=a(226);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};a(72)(r,n);r.locals&&(e.exports=r.locals)},188:function(e,t,a){"use strict";a.r(t);var r=a(189),n=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);t.default=n.a},189:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n,i=p(a(181)),o=p(a(182)),u=p(a(174)),s=p(a(191)),l=p(a(192)),c=a(193),d=a(194),f=a(175);function p(e){return e&&e.__esModule?e:{default:e}}t.default={name:"operateLayer",mixins:[c.getMap,d.dataMixins],props:{showMinZoom:{type:Number,default:3},defaultLineSymbol:{type:Object,default:function(){return{"line-color":"#ff4500","line-width":3}}},defaultSymbol:{type:Object,default:function(){return{"fill-color":"#ff0000","fill-opacity":0}}}},mounted:function(){this.layer=this.initLayer(),this.clear(),this.initOperate()},methods:{initLayer:function(){var e="operateLayer";return this.map.getLayer(e)||(this.map.addSource(e+"Source",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:e+"-line",type:"line",source:e+"Source",layout:{},paint:(0,u.default)({},this.defaultLineSymbol)}),this.map.addLayer({id:e,type:"fill",source:e+"Source",layout:{},paint:(0,u.default)({},this.defaultSymbol)})),this.map.getLayer(e)},initOperate:(n=(0,o.default)(i.default.mark((function e(){var t,a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.map.getZoom()>=this.$props.showMinZoom)){e.next=6;break}return e.next=4,this.getOperateArea();case 4:(t=e.sent)&&t.length&&(a=this.geojsonToGeo(t),this.renderGeo(a,!1));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)}),addViewChange:function(){var e=this;this.map.on("moveend",(0,o.default)(i.default.mark((function t(){var a,r;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.map.getZoom()>=e.$props.showMinZoom)){t.next=8;break}return t.next=4,e.getOperateArea();case 4:(a=t.sent)&&a.length&&(r=e.geojsonToGeo(a),e.renderGeo(r,!1)),t.next=9;break;case 8:e.clear();case 9:case"end":return t.stop()}}),t,e)}))))},addLayerClick:function(){var e=this;this.map.on("click","operateLayer",(function(t){e.$emit("click",t)}))},getOperateArea:(r=(0,o.default)(i.default.mark((function e(){var t,a,r,n,o,u,c;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.default.getAreaInfoByAreaCode,a=t.url,r=t.request_type,e.prev=2,e.next=5,s.default.Ajax(""+f.blockUrl+a,{request_type:r,paramCodeList:"KJ5002",areaCode:"440305"});case 5:if(n=e.sent,o=n.data,u=o.retCode,c=o.data,"00000"!==u){e.next=11;break}return e.abrupt("return",c.list);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.log(e.t0),this.clear();case 17:case"end":return e.stop()}}),e,this,[[2,13]])}))),function(){return r.apply(this,arguments)}),clear:function(){this.map.getSource(this.layer.id+"Source").setData({type:"FeatureCollection",features:[]})}}}},225:function(e,t,a){"use strict";var r=a(187);a.n(r).a},226:function(e,t,a){(e.exports=a(71)(!1)).push([e.i,".map[data-v-9474feb2]{width:100%;height:100%}\n",""])},227:function(e,t,a){"use strict";a.r(t);var r=a(228),n=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);t.default=n.a},228:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(a(169)),n=s(a(168)),i=s(a(170)),o=s(a(167)),u=a(77);function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"mapMain",data:function(){return{headOption:{back:!0,title:"地图",heightLine:1},positionData:{},coordinates:[0,0],wgData:[],wgSymbol:{lineColor:"red",lineWidth:2},buildSymbol:{lineColor:"red",lineWidth:2,polygonFill:"rgb(135,255,0,0.5)",polygonOpacity:.6},hasMaskLayer:!0}},components:{mapLayer:r.default,districtLayer:n.default,operateLayer:i.default,buildLayer:o.default},created:function(){},methods:{handleBuildLayerClick:function(e){var t=e.features;if(0!==t.length){var a=t[0].properties;u.Toast.success(a)}},handleBaseLayerClick:function(e){var t=e.properties;console.log(t),"1"!==t.hasCollect||u.Toast.fail("该楼栋已采集")}}}},229:function(e,t,a){var r=a(299);"string"==typeof r&&(r=[[e.i,r,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};a(72)(r,n);r.locals&&(e.exports=r.locals)},231:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return n}));var r=function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"map",attrs:{id:this.domId}},[this.mapFlag?this._t("default"):this._e()],2)},n=[];r._withStripped=!0},298:function(e,t,a){"use strict";var r=a(229);a.n(r).a},299:function(e,t,a){(e.exports=a(71)(!1)).push([e.i,".layout[data-v-238590d5]{width:100%;height:100%}.layout-map[data-v-238590d5]{width:100%;height:100%;position:absolute;left:0;top:0;right:0;bottom:0}\n",""])},302:function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return n}));var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"layout"},[a("div",{staticClass:"layout-map"},[a("map-layer",{ref:"map",on:{click:function(t){return e.handleBaseLayerClick(t)}}},[a("operate-layer",{ref:"operateLayer"}),e._v(" "),a("district-layer",{ref:"districtLayer"}),e._v(" "),a("build-layer",{ref:"buildLayer",on:{click:function(t){return e.handleBuildLayerClick(t)}}})],1)],1)])},n=[];r._withStripped=!0}}]);