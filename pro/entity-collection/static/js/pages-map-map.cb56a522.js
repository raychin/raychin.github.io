(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-map-map"],{"2ff1":function(t,e,a){"use strict";var i=a("e3bb"),o=a.n(i);o.a},"4db4":function(t,e,a){"use strict";a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){return i}));var i={uniSearchBar:a("1c61").default},o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"map-wrap"},[a("v-uni-view",{staticClass:"hd-wrap",class:{"hd-wrap-select":t.searchValue}},[a("header",{staticClass:"hd-box"},[a("v-uni-view",{staticClass:"hd-search-wrap"},[a("v-uni-view",{staticClass:"search-all",class:[{"search-all-height":"1"==t.pageType}]},[a("v-uni-view",{staticClass:"back-css",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.back(1)}}},[a("v-uni-image",{staticClass:"back-icon",attrs:{src:"/static/imgs/icon/back.png"}})],1),"1"==t.pageType?a("v-uni-view",{staticClass:"title-nav"},[t._v("地图")]):a("v-uni-view",{staticClass:"all-left"},[a("uni-search-bar",{staticClass:"search-input",attrs:{placeholder:"关键字搜索"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.searchAddr.apply(void 0,arguments)},input:function(e){arguments[0]=e=t.$handleEvent(e),t.searchInput.apply(void 0,arguments)},cancel:function(e){arguments[0]=e=t.$handleEvent(e),t.cancelSearch()}}})],1)],1),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.bulidingListShow,expression:"bulidingListShow"}],staticClass:"search-list"},[t.searchState?a("v-uni-view",{staticClass:"search-status"},[t._v("搜索中...")]):t._e(),t.bulidingList.length||t.searchState||""==t.searchValue?t._l(t.bulidingList,(function(e,i){return a("v-uni-view",{key:"bulidingList"+i,staticClass:"search-item",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.goTarget(e)}}},[a("v-uni-view",{staticClass:"left"},[a("v-uni-image",{attrs:{src:"/static/imgs/icon/location1.png"}})],1),a("v-uni-view",{staticClass:"right"},[a("h3",{staticStyle:{"font-size":"30rpx"}},[t._v(t._s(e.addr.substring(6)))]),a("p",{staticStyle:{"font-size":"28rpx"}},[t._v(t._s(e.code))])])],1)})):a("v-uni-view",{staticClass:"search-status"},[t._v("未查询到地址")])],2)],1)],1)]),a("v-uni-view",{staticClass:"bd-wrap"},[a("v-uni-view",{staticClass:"map-all"},[a("v-uni-view",{staticClass:"map-container",staticStyle:{background:"#C0D7F8"},attrs:{id:"map"}}),a("v-uni-view",[t.isShowRouter?a("v-uni-view",{staticClass:"bottom"},[a("v-uni-view",{staticClass:"bottom2"},[a("p",{staticStyle:{"font-size":"34rpx","margin-right":"100rpx"}},[t._v(t._s(this.bottomTitle))]),a("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.isShowRouter&&"0"==t.pageType,expression:"isShowRouter && pageType == '0'"}],staticClass:"bottom_router",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toBuilding()}}},[t._v("确定")])],1),a("v-uni-view",{staticStyle:{display:"flex","align-items":"center"}},[a("v-uni-view",[a("v-uni-image",{staticStyle:{width:"30rpx",height:"26rpx","margin-right":"10rpx"},attrs:{src:"/static/imgs/icon/location1.png"}})],1),a("p",{staticStyle:{"font-size":"26rpx",color:"#999999"}},[t._v(t._s(this.bottomCon))])],1)],1):t._e()],1)],1),a("v-uni-view",{staticClass:"map-location",class:[t.isShowRouter?"map-location-top":""],on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toPositionReal(!0)}}},[a("v-uni-image",{attrs:{src:"/static/imgs/icon/location_but_dw.png"}})],1)],1)],1)},n=[]},"6fdf":function(t,e,a){"use strict";a.r(e);var i=a("ce43"),o=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(n);e["default"]=o.a},cdaa:function(t,e,a){var i=a("24fb");e=i(!1),e.push([t.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 主色 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.map-location[data-v-91edf946]{position:absolute;z-index:2;bottom:0;left:0;padding:10px}.map-location uni-image[data-v-91edf946]{width:20px;height:20px}.map-location-top uni-image[data-v-91edf946]{bottom:96px}.map-wrap[data-v-91edf946]{width:100%;height:100%}.map-wrap .drawer[data-v-91edf946]{padding:%?5?%}.map-wrap .drawer .filtrate-mask[data-v-91edf946]{padding:%?0.15?%}.map-wrap .drawer .filtrate-mask .mask-title[data-v-91edf946]{font-size:%?0.14?%;font-weight:400;color:#333;margin:%?0.1?% 0 %?0.1?% 0}.map-wrap .drawer .filtrate-mask .mask-time .mask-time-start[data-v-91edf946]{display:-webkit-box;display:-webkit-flex;display:flex;background:#f3f3f3;padding:%?0.1?% %?0.13?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center;border-radius:3px}.map-wrap .drawer .filtrate-mask .mask-time .mask-time-start[data-v-91edf946]{margin-bottom:%?0.07?%}.map-wrap .drawer .btn-mask-wrap[data-v-91edf946]{width:100%;height:%?80?%;position:absolute;left:0}.map-wrap .drawer .btn-mask-wrap .btn-mask[data-v-91edf946]{width:100%;display:-webkit-box;display:-webkit-flex;display:flex;height:100%;line-height:%?80?%;text-align:center}.map-wrap .drawer .btn-mask-wrap .btn-mask .btn-mask-left[data-v-91edf946],\n.map-wrap .drawer .btn-mask-wrap .btn-mask .btn-mask-right[data-v-91edf946]{height:100%;width:50%;text-align:center;margin:auto 0;font-size:%?28?%;font-weight:700;color:#666}.map-wrap .drawer .btn-mask-wrap .btn-mask .btn-mask-left[data-v-91edf946]{background:#fff}.map-wrap .drawer .btn-mask-wrap .btn-mask .btn-mask-right[data-v-91edf946]{background:#4ca4fe;color:#fff}.map-wrap .hd-wrap[data-v-91edf946]{position:fixed;width:100%;z-index:2}.map-wrap .hd-wrap-select[data-v-91edf946]{background:#fff}.map-wrap .bd-wrap[data-v-91edf946]{position:absolute;top:0;bottom:0;right:0;left:0;z-index:1;width:100%}.hd-search-wrap .search-all-height[data-v-91edf946]{height:%?100?%}.hd-search-wrap .search-all[data-v-91edf946]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;padding:0 %?10?%;width:100%;background-color:#fff}.hd-search-wrap .search-all .back-css[data-v-91edf946]{padding:%?10?% %?15?% %?10?% %?10?%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.hd-search-wrap .search-all .back-css .back-icon[data-v-91edf946]{width:%?46?%;height:%?46?%}.hd-search-wrap .search-all .title-nav[data-v-91edf946]{position:absolute;width:60%;left:20%;z-index:2;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;text-align:center;height:%?100?%;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;color:#333;font-size:%?34?%;font-weight:700;text-align:center;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.hd-search-wrap .search-all .all-left[data-v-91edf946]{-webkit-box-flex:1;-webkit-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;background-color:#fff}.hd-search-wrap .search-all .all-left .search-input[data-v-91edf946]{-webkit-box-flex:1;-webkit-flex:1;flex:1}.hd-search-wrap .search-all .all-left[data-v-91edf946] .uni-searchbar__cancel{font-size:%?30?%}.hd-search-wrap .search-all .search-all-left[data-v-91edf946]{-webkit-box-flex:1;-webkit-flex:1;flex:1;padding:0;font-size:%?28?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.hd-search-wrap .search-all .search-all-img[data-v-91edf946]{width:%?42?%;height:%?42?%;margin-left:%?28?%}.hd-search-wrap .search-all[data-v-91edf946] .uni-searchbar{background-color:initial}.map-all[data-v-91edf946]{position:absolute;top:0;bottom:0;right:0;left:0;overflow:hidden}.map-all .map-container[data-v-91edf946]{height:100%}.map-all[data-v-91edf946] .mapboxgl-ctrl-attrib.mapboxgl-compact{display:none}.map_text[data-v-91edf946]{font-size:50px;color:red}.map_text1[data-v-91edf946]{font-size:50px;color:red}.search-list[data-v-91edf946]{width:100%;max-height:%?800?%;background:#fff;position:absolute;top:100%;left:0;overflow:auto;border-bottom-left-radius:10px;border-bottom-right-radius:10px;box-shadow:0 2px 2px #ccc}.search-status[data-v-91edf946]{text-align:center;font-size:%?26?%;line-height:%?200?%}.search-item[data-v-91edf946]{border-bottom:1px solid #eee;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;padding:%?20?%}.search-item .left[data-v-91edf946]{width:%?50?%}.search-item .left uni-image[data-v-91edf946]{width:%?40?%;height:%?40?%}.search-item .right[data-v-91edf946]{-webkit-box-flex:1;-webkit-flex:1;flex:1;margin-left:%?10?%}.search-item .right h3[data-v-91edf946]{font-size:%?24?%;font-weight:400;color:#333}.search-item .right p[data-v-91edf946]{margin-top:%?6?%;font-size:%?12?%;color:#666}.search-item:last-child .right[data-v-91edf946]{border-bottom:none}.map[data-v-91edf946]{width:375px;height:100vh;position:relative}.map .fixed[data-v-91edf946]{background:#fff;border-radius:50%;position:absolute;right:%?0.2?%;bottom:%?2.8?%;z-index:100;width:%?0.8?%;height:%?0.8?%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;box-shadow:0 0 4px #ccc}.map .fixed img[data-v-91edf946]{width:%?0.6?%;height:%?0.6?%;margin:0 auto}.left-view[data-v-91edf946]{width:35%;left:%?50?%;top:%?150?%;position:absolute;background:#fff;z-index:999}.left-view[data-v-91edf946] .uni-collapse-cell{border-color:#fff}.bottom[data-v-91edf946]{background-color:#fff;width:100%;bottom:0;position:absolute;z-index:999;padding:%?30?%;border-top-left-radius:10px;border-top-right-radius:10px;box-shadow:0 0 2px #ccc}.bottom2[data-v-91edf946]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin-bottom:%?0.1?%}.bottom_router[data-v-91edf946]{background:#4ca4fe;height:%?100?%;width:%?100?%;line-height:%?100?%;\n  /*padding: 0.04rpx ;*/border-radius:50%;\n  /*width: 100%;*/right:%?20?%;top:%?-40?%;position:absolute;z-index:999;text-align:center;color:#fff;font-size:%?30?%;box-shadow:0 0 2px #4ca4fe}',""]),t.exports=e},ce43:function(t,e,a){"use strict";var i=a("4ea4");a("4de4"),a("4160"),a("fb6a"),a("a434"),a("b64b"),a("d3b7"),a("ac1f"),a("25f0"),a("3ca3"),a("841c"),a("159b"),a("ddb0"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(a("5530"));a("96cf");var n=i(a("1da1")),s=a("6946"),r=a("1c61");a("b9fe");var l,c,d,h,u,f,p=i(a("8d81")),m=a("2f62"),g=a("1924"),b=i(a("d040")),w=(i(a("34dd")),i(a("48d0"))),v=i(a("df0e")),k=i(a("53d0")),x=(i(a("e143")),i(a("0bc5")),a("972a")),y=(a("8760"),null),C={name:"building-map",components:{UniSearchBar:r.UniSearchBar,YyhBuilding:s.YyhBuilding},data:function(){return{positionImg:"/static/assets/imgs/icon/map-position.png",drawerVisible:!1,scanImg:"/static/assets/image/imgs/scan.png",timestamp:(new Date).getTime(),areacode:"440309",areaname:"光明区",parentcode:"4403",parentname:"深圳市",FeatureCollection:{type:"FeatureCollection",features:[]},moveend:!1,zoomChange:!1,isClick:!1,isMove:!1,search:!1,searchValue:"",selectValue:"",searchState:!1,searchReturn:{},bulidingList:[],bulidingListShow:!1,bottomTitle:"",bottomCon:"",isShowRouter:!1,queryParams:{},blockToken:"",areaInfo:[],isClickBuildingOnly:!0,dataToken:"",buildingList:[],buildingLevelList:[]}},onShow:function(){this.areaInfo=this.$store.state.areaInfo,this.areaInfo.forEach((function(t,e){}))},mounted:function(){var t=this;return(0,n.default)(regeneratorRuntime.mark((function e(){var a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a="18672343372",e.next=3,t.ksjGetLoginTokenGM(a);case 3:return i=e.sent,e.next=6,t.ksjGetTokenGM(a,i.data);case 6:e.sent,t.mapInit();case 8:case"end":return e.stop()}}),e)})))()},created:function(){var t=this;uni.$on("updateBuildingInfo",(function(e){t.buildingInfo={},Object.keys(e).length>0&&(t.buildingInfo=JSON.parse(e))}))},watch:{areacode:function(t){},areaInfo:function(t,e){},showCovered:function(t){t&&this.changAreaCodeEvent(this.areacode)},showMarkerByMap:function(t){t&&this.drawInAreaLayer(440309)},newValue:function(t,e){console.log(t),console.log(e),this.bulidingList=[],t!==e&&t!==this.selectValue&&(this.bulidingList=[],t?this.searchAddr(t):(this.bulidingListShow=!1,this.isShowRouter=!1,this.bulidingList=[],console.log(this.bulidingListShow)))}},computed:(0,o.default)({newValue:function(){return this.searchValue}},(0,m.mapState)(["showCovered","showMarkerByMap"]),{pageType:function(){return this.$route.query.pageType?this.$route.query.pageType:0},chooseRoom:function(){return this.$route.query.chooseRoom?this.$route.query.chooseRoom:1}}),methods:{toBuilding:function(t){"0"!=this.chooseRoom?uni.navigateTo({url:"../choose-room/choose-room"}):uni.navigateBack({delta:1})},ksjGetToken:function(){var t=this;return new Promise((function(e,a){t.$api.ksjGetToken({accessToken:t.$store.state.loginData.accessToken}).then((function(a){a.success?(t.dataToken=a.data.token,t.$store.commit("updateDataToken",a.data.token),e(!0)):e(!1)}))}))},ksjGetLoginTokenGM:function(t){var e=this;return new Promise((function(a,i){e.$api.ksjGetLoginTokenGM({digest:(0,p.default)(t),data:t}).then((function(t){t.success?a(t):i()}))}))},ksjGetTokenGM:function(t,e){var a=this;return new Promise((function(i,o){a.$api.ksjGetTokenGM({digest:(0,p.default)(t),data:e}).then((function(t){t.success?(a.dataToken=t.data.tokenValue,a.$store.commit("updateDataToken",t.data.tokenValue),i(!0)):o()}))}))},toPositionReal:function(t){var e=this;e.currentLon="113.93133505087422",e.currentLat="22.75179694257504",e.toPositionRealFinal(t)},toPositionRealFinal:function(t){var e=this;u||(u=new v.default(d)),console.log(!t),setTimeout((function(){!t&&e.$store.state.mapData&&e.$store.state.mapData.LON&&e.$store.state.mapData.LAT?(d.setCenter(new GeoGlobe.LngLat(e.$store.state.mapData.LON,e.$store.state.mapData.LAT),16.1),e.setClickDataToMap(e.$store.state.mapData.LON,e.$store.state.mapData.LAT,!1)):d.setCenter(new GeoGlobe.LngLat(e.currentLon,e.currentLat),16.1),d.setZoom(16.1),u.setImagePoint(e.currentLon,e.currentLat,"location")}),1e3)},back:function(t){uni.navigateBack(t)},toReset:function(){this.drawAreaLayer(440309),this.drawInAreaLayer(440309),d.flyTo({center:[113.93133505087422,22.75179694257504],zoom:10}),this.isShowRouter=!1,this.$refs.drawer.close()},toConfirm:function(){this.$refs.regionalTree.saveData(),this.$refs.drawer.close()},getFiltrate:function(){this.$refs.drawer.open()},searchInput:function(t){this.searchValue=t},mapInit:function(){d=new GeoGlobe.Map({mapCRS:{topTileExtent:[-180,-270,180,90],coordtransform:"none",epsg:4490,isIntScrollZoom:!0},style:g.style,container:"map",zoom:10,minZoom:10,maxZoom:24,units:"degrees",center:[114.06455184,22.54845664],pitch3Dzoom:18}),d.addControl(new mapboxgl.NavigationControl({showCompass:!0,showZoom:!0}),"bottom-right"),this.mapFunCom()},mapFunCom:function(){var t=this;c=new k.default,l=new b.default(d),h=new w.default(d),u=new v.default(d),f=new v.default(d),d.on("load",(function(){d.touchZoomRotate.disableRotation(),Promise.all([l.addSourceAndLayer(),f.addImagePoint(null,null)]).then((function(e){t.drawAreaLayer(440309),t.drawInAreaLayer(440309)}))})),this.mapMouseEvent(d),this.mapMoveendEvent(d),this.mapZoomEvent(d),this.mapClickEvent(d),this.toPositionReal()},mapChangeEvent:function(){var t=d.getZoom(),e=d.getCenter();e.lng,e.lat;if(console.log("Zoom",t),t<=10)"1";else if(t>=10&&t<13)"2";else if(t>=13&&t<15){"3";d.getSource("building")}else t>=15&&t<16?"4":t>=16&&("5",this.getBuildData(this.getBounds()))},itemClick:function(t,e){if(t&&t.areacode){var a;switch(t.areacode.length){case 4:a=10;break;case 6:a=11.5;break;case 9:a=13.5;break;case 12:a=15.5;break;case 15:a=16.5;break}this.drawAreaLayer(t.areacode).then((function(t){t&&d.flyTo({center:[t.lon,t.lat],zoom:a})}))}},mapZoomEvent:function(t){var e=this;t.on("zoomend",(function(){e.mapChangeEvent()}))},mapMoveendEvent:function(t){var e=this;t.on("moveend",(function(){e.mapChangeEvent()}))},mapMouseEvent:function(t){var e=this,a=new mapboxgl.Popup({closeButton:!1,closeOnClick:!1});t.on("mousemove","fillIn_layer",(function(i){var o=t.getZoom();if(e.areacode.length<12&&o<15){var n=i.features[0].properties.areacode;e.lightCode!==n&&(e.lightCode=n,t.setPaintProperty("fillIn_layer","fill-opacity",["match",["get","areacode"],n,.5,0]))}if(12===e.areacode.length){var s=i.lngLat,r=i.features[0].properties.areaname;a.setLngLat(s).setHTML(r).addTo(t)}})),t.on("mouseleave","fillIn_layer",(function(i){e.lightCode="",t.setPaintProperty("fillIn_layer","fill-opacity",0),a.rpxove()}));new mapboxgl.Popup({closeButton:!1,closeOnClick:!1})},mapClickEvent:function(t){var e=this,a=this;t.on("click",(function(i){if("1"!=a.pageType){var o=t.queryRenderedFeatures(i.point,{layers:["bianjie-highlighted-fills"]});if(console.log("选中区域",o),0!=o.length){var n=t.queryRenderedFeatures(i.point,{layers:["build-fills"]}),s=t.queryRenderedFeatures(i.point,{layers:["grid-fills"]});e.getClickData(n,i,s),t.getCanvas().style.cursor=n.length?"pointer":""}else uni.showToast({title:"请在可操作范围内操作!",icon:"none"})}}))},getClickData:function(t,e,a){this.setClickData(t,e,a,!1)},setClickData:function(t,e,a,i){var n=e.lngLat.lng,s=e.lngLat.lat,r=this;if(t.length>0&&this.$store.commit("updateBuildingSource",t[0]),i)t.length>0?this.setClickDataToMap(n,s,!1):this.setClickDataToMap(n,s,!0);else if(console.log("楼栋features",t),console.log("网格features1",a),t.length>0){var l={};l=r.$store.state.mapData?(0,o.default)({},r.$store.state.mapData,{},t[0].properties):(0,o.default)({},t[0].properties),r.$store.commit("updateMapData",l),f||(f=new v.default(d)),this.setClickDataToMap(t[0].properties.LON,t[0].properties.LAT,!1)}else if(a.length&&!this.isClickBuildingOnly){var c={};c=r.$store.state.mapData?(0,o.default)({},r.$store.state.mapData,{},a[0].properties):(0,o.default)({},a[0].properties),r.$store.commit("updateMapData",c),this.setClickDataToMap(t[0].properties.LON,t[0].properties.LAT,!0)}else this.isClickBuildingOnly||uni.showToast({title:"未匹配数据结果!",icon:"none"})},setFilter:function(t){var e=[];return e.push(t[0]),e.push(t[1]),t[2]&&""!==t[2]?e.push(t[2]):e.push("empty"),e},setClickDataToMap:function(t,e,i,o){var n=a("124b");f||(f=new v.default(d)),f.addImagePoint(t,e,n,"clickBuilding"),i?(this.gridSelect=!0,this.filter=this.setFilter(["==","JZWTYDZBM",""])):(this.gridSelect=!1,this.filter=this.setFilter(["==","JZWTYDZBM",this.$store.state.mapData.JZWTYDZBM]),this.queryParams.areacode=this.$store.state.mapData.JZWTYDZBM,this.queryParams.ldmc=this.$store.state.mapData.BZDZ),d.setFilter("build_choose_hover",this.filter),this.setAddressData(t,e,this.$store.state.mapData.BZDZ,o),this.isShowRouter=!0,this.search=!1},drawAreaLayer:function(t){var e=this;return new Promise((function(a,i){var o=!1;e.$api.getAreaInfoByAreaCodeBlockCommon(e.dataToken,t,o).then((function(i){if(i.success&&i.data.list.length>0){var n,s=i.data.list[0],r=(i.data.list[0].areacode,i.data.list[0].parentcode,c.convertFeatureCollection(i.data.list,o)),d=e.$store.state.areaInfo;switch(t.toString().length){case 4:n="city",d=d.slice(0,1);break;case 6:n="region",d=[],d.push({areacode:s.areacode,areaname:s.areaname});break;case 9:n="street",d.splice(1,d.length-1),d.push({areacode:s.areacode,areaname:s.areaname});break;case 12:n="community",d.splice(2,d.length-1),d.push({areacode:s.areacode,areaname:s.areaname});break;case 15:n="grid",d.splice(3,d.length-1),d.push({areacode:s.areacode,areaname:s.areaname});break}console.log(n),e.$store.commit("updateAreaInfo",d),e.areaInfo=e.$store.state.areaInfo,l.setSourceData(n,r),l.setSourceData("bianjie",r),a(s)}else a("")}))}))},drawInAreaLayer:function(t){var e=this;return new Promise((function(a,i){var o=!0;e.$api.getAreaInfoByAreaCodeBlockCommon(e.dataToken,t,o).then((function(i){if(i.success){var n;switch(t.toString().length){case 4:n="region";break;case 6:n="street";break;case 9:n="community";break;case 12:n="grid";break}if(15!==t.toString().length){var s={name:i.data.chirdAreaList.name,code:i.data.chirdAreaList.code};e.$store.commit("updateAreaList",s)}l.setSourceData(n,c.convertFeatureCollection(i.data.chirdAreaInfo,o)),a(!0)}else a(!0)}))}))},clearFeatureCollection:function(t){l.clearSourceData(t)},addMarkerList:function(t,e){if(e.length<=12)for(var a=0;a<t.length;a++){var i=document.createElement("view");1===this.currentLayer?i.className="map_text":i.className="map_text1",i.innerHTML=t[a]._source.areaname;var o=t[a]._source.location.coordinates,n=[0,0];h.addMarker(i,o,n)}},searchAddr:function(t){var e=this;if(this.searchValue){if(console.log(this.$store.state.comToken),!this.$store.state.comToken)return void this.getTokenFZ();this.bulidingListShow=!0,this.searchState=!0;var a=t||this.searchValue,i={param:{token:this.$store.state.comToken,addr:a,limit:100,page:1},url:"/addrMatch/addrApi/searchAddr",method:"GET"};this.$api.addressSearch(i.param).then((function(t){t.success?(e.searchState=!1,t.data&&t.data.addrList&&t.data.addrList.length>0&&(e.searchState=!1,e.bulidingList=t.data.addrList)):e.getTokenFZ(a)}))}},getTokenFZ:function(t){var e=this;this.timestamp=(new Date).getTime();var a={param:{user:x.config.requestUrl.uniformUser,secret:(0,p.default)(this.timestamp+x.config.requestUrl.uniformPassword),time:this.timestamp},url:"/addrMatch/auth/getToken",method:"GET"};this.$api.addressToken(a.param).then((function(a){if(a.success){var i=a.data;i&&i.token&&(e.comToken=i.token,e.$store.commit("updateComToken",i.token),t&&e.searchAddr(t))}}))},goTarget:function(t){if(this.searchReturn=t,console.log(t),t.code&&t.code.length>18)if(this.queryParams.areacode=t.code.substring(0,19),this.search=!0,this.selectValue=t.addr.substring(6),this.bulidingListShow=!1,t.lon){var e=t.lon,a=t.lat;null!==y&&y.rpxove(),d.setCenter(new GeoGlobe.LngLat(e,a),16.5),d.setZoom(16.5),this.isShowRouter=!0}else this.$api.getAreaInfoByAreaCodeBlockCommon(this.dataToken,t.code.substring(0,19),!1).then((function(t){t.success?console.log(t):uni.showToast({title:"无法获取经纬度，定位失败！",icon:"none"})}));else uni.showToast({title:"请选中楼栋",icon:"none"})},searchPlay:function(t){var e=this,a={};a.BZDZ=t.addr,a.JCWGBM=t.wgdm,a.JCWGMC=t.wgmc||"网格名称",a.JDBM=t.jddm,a.JDMC=t.street,a.JZWTYDZBM=t.belong_building,a.CODE=t.code,a.LAT=t.lat,a.LDMC=t.village,a.LON=t.lon,a.QBM=t.qudm,a.QMC=t.district,a.SBM=t.shidm,a.SMC=t.city,a.SQBM=t.sqdm,a.SQMC=t.community;var i={};i=e.$store.state.mapData?(0,o.default)({},e.$store.state.mapData,{},a):(0,o.default)({},a),e.$store.commit("updateMapData",i),console.log(t);var n=t.lon,s=t.lat;this.setClickDataToMap(n,s,!1)},cancelSearch:function(){this.searchValue="",this.searchState=!1,this.bulidingListShow=!1,this.isShowRouter=!1,this.bulidingList=[]},getBuildData:function(t){var e=this;this.$api.getAreaInfoByCoordinatesBlockCommon(this.dataToken,JSON.stringify(t),5).then((function(t){e.useWgData(t.data.list)})),this.$api.getAreaInfoByCoordinatesBlockCommon(this.dataToken,JSON.stringify(t),6).then((function(t){e.showBuild(t.data.list)}))},useWgData:function(t){var e=c.useCodeData(t);e.length>0&&l.setSourceData("grid",e)},showBuild:function(t){var e=c.useCodeData(t);if(e.length>0){var a=JSON.parse(JSON.stringify(this.buildingLevelList));a.length>0&&a.forEach((function(t){for(var a=0;a<e.length;a++)if(t.buildingCode==e[a].properties.JZWTYDZBM){e[a].properties.LEVEL=t.leave,e[a].properties.buildingObject=t;break}})),l.setSourceData("building",e),this.search&&this.searchPlay(this.searchReturn),this.isShowRouter&&(this.filter=this.setFilter(["==","JZWTYDZBM",this.queryParams.areacode]),d.setFilter("build_choose_hover",this.filter))}this.zoomChange=!0},getBounds:function(){return l.getBounds()},btnRouter:function(){var t=this;console.log(this.queryParams),this.$store.state.mapData.CODE&&this.$store.state.mapData.CODE.length>19?uni.navigateTo({url:"./houseDetails?areaCode=".concat(this.$store.state.mapData.CODE)}):window.setTimeout((function(){uni.navigateTo({url:"./buildingDetails?areaCode=".concat(t.$store.state.mapData.JZWTYDZBM)})}),400)},setAddressData:function(t,e,a,i){i?(this.$store.state.mapData.JZWTYDZBM?this.bottomTitle=this.$store.state.mapData.LDMC?this.$store.state.mapData.LDMC:a:this.bottomTitle=this.$store.state.mapData.JCWGMC?this.$store.state.mapData.JCWGMC:a,this.bottomCon=a):this.$store.state.mapData.JZWTYDZBM?(this.bottomTitle=this.$store.state.mapData.LDMC?this.$store.state.mapData.LDMC:a,this.bottomCon=a):(this.bottomTitle=this.$store.state.mapData.JCWGMC,this.bottomCon=a)}}};e.default=C},cf4e:function(t,e,a){"use strict";a.r(e);var i=a("4db4"),o=a("6fdf");for(var n in o)["default"].indexOf(n)<0&&function(t){a.d(e,t,(function(){return o[t]}))}(n);a("2ff1");var s,r=a("f0c5"),l=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"91edf946",null,!1,i["a"],s);e["default"]=l.exports},e3bb:function(t,e,a){var i=a("cdaa");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=a("4f06").default;o("08de3dbf",i,!0,{sourceMap:!1,shadowMode:!1})}}]);